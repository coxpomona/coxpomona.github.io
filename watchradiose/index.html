<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WatchRadioSE - Beta & Utveckling</title>
    <!-- Laddar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Anpassad styling för en ren, teknisk känsla */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb; /* Ljusare bakgrund */
            color: #1f2937; /* Mörkgrå text */
        }
        .container {
            max-width: 1024px;
        }
        .section-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        }
        .header-bg {
            background-color: #10172a; /* Mörk, teknisk header */
        }
        .highlight {
            color: #10b981; /* Grön accentfärg för viktiga detaljer */
            font-weight: 600;
        }
        /* Styling för den specifika bilden */
        .watch-preview-img {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .watch-preview-img:hover {
             transform: scale(1.02);
        }
        /* Responsivitet för bild */
        @media (min-width: 768px) {
            .watch-img-container {
                max-width: 450px;
            }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header / Banner -->
    <header class="header-bg text-white py-12">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-5xl font-extrabold mb-2 tracking-tight">WatchRadioSE</h1>
            <p class="text-xl font-light opacity-80">Wear OS-app för fristående radioströmning - Vi söker testare!</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 md:py-12">

        <!-- NY BILD-POSITION: Direkt under headern, i hel brädd -->
        <div class="flex justify-center w-full mb-8">
            <img src="https://coxpomona.github.io/watchradiose/watchradiose_funktionsbild.png" 
                 alt="Skärmdumpar av WatchRadioSE-appen på en Wear OS-klocka" 
                 class="watch-preview-img w-full max-w-2xl">
        </div>

        <!-- Sektion 1: Kort sammanfattning (Huvudentrén) -->
        <section class="section-card bg-white p-6">
            <!-- Text Summary block (nu i hel bredd) -->
            <div class="mb-6">
                <h2 class="text-3xl font-bold mb-3 text-indigo-700">Frihet på Handleden: Radio utan Telefon</h2>
                <p class="text-xl text-gray-700 leading-relaxed">
                    WatchRadioSE är en helt fristående Wear OS-app som låter dig strömma svenska radiokanaler (via SR:s öppna webbströmmar) direkt på klockan, över LTE eller Wi-Fi.
                </p>
                <p class="mt-6 font-semibold text-red-600 border-t pt-4">
                    <span class="text-2xl block mb-2">Hjälp oss lansera!</span>
                    Vi behöver aktiva betatestare för att uppfylla Google Play Consoles krav och möjliggöra den publika lanseringen. Din feedback är avgörande.
                </p>
            </div>
        </section>

        <!-- Sektion 2: Huvudpresentation/Pitch -->
        <section class="section-card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2 border-gray-200">Kritiskt Behov: Testare sökes!</h2>
            <div class="text-gray-700 text-lg space-y-4">
                <p>Appen är utvecklad för att spela direktströmningar av radiokanaler från Sveriges Radio direkt på din klocka, perfekt för löprundan eller när du vill ha radion nära till hands utan att behöva ta fram mobilen.</p>
                <p class="font-bold text-red-600">För att kunna publicera appen på Google Play Store kräver Google att vi har minst 12 aktiva testare som behåller appen i 14 dagar.</p>
                
                <h3 class="text-xl font-semibold mt-6 mb-2 text-indigo-700">Så går du med i betatestet:</h3>
                <ol class="list-decimal list-inside space-y-2 ml-4">
                    <li>Fyll i din e-postadress i formuläret nedan. Vi använder den för att lägga till dig som testare i Google Play Console.</li>
                    <li>Klicka på testlänken när du har fått bekräftelse, eller använd den direkt: 
                        <a href="https://play.google.com/apps/testing/com.watchradiose.radio.wearos" target="_blank" class="text-indigo-600 hover:underline font-medium break-all">
                            https://play.google.com/apps/testing/com.watchradiose.radio.wearos
                        </a>
                    </li>
                    <li>När du har gått med via länken kan du ladda ner WatchRadioSE via Play Store på din Wear OS-klocka.</li>
                </ol>
                <p class="mt-6">Stort tack på förhand för hjälpen! Din insats är vad som gör en publik lansering möjlig.</p>
            </div>
        </section>
        
        <!-- Sektion 3: Registrering för Betatest -->
        <section class="section-card bg-indigo-50 border-indigo-200">
            <h2 class="text-3xl font-semibold mb-4 text-indigo-600 border-b pb-2 border-indigo-200">1. Anmäl din e-postadress här</h2>
            <p class="mb-6 text-gray-700">Fyll i formuläret nedan. Vi behöver den e-postadress som är kopplad till ditt Google Play-konto på klockan för att lägga till dig i betagruppen. Det är viktigt att du använder rätt konto för att testinbjudan ska fungera.</p>
            
            <form id="betaSignupForm" class="max-w-xl mx-auto p-4 bg-white rounded-lg shadow-lg">
                <div class="mb-4">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Ditt namn (Frivilligt)</label>
                    <input type="text" id="name" name="name" placeholder="Förnamn Efternamn" class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-postadress (Obligatoriskt för testning)*</label>
                    <input type="email" id="email" name="email" placeholder="ditt.google.konto@mail.com" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    <p class="mt-1 text-xs text-gray-500">Måste vara den e-postadress som är kopplad till ditt Google Play-konto på din Wear OS-klocka.</p>
                </div>
                <div class="mb-6">
                    <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Meddelande/Klockmodell (Frivilligt)</label>
                    <textarea id="message" name="message" rows="3" placeholder="T.ex. 'Jag testar på en Samsung Galaxy Watch 5 Pro' eller andra kommentarer." class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                </div>
                <button type="submit" id="submitBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Skicka in min e-postadress
                </button>
            </form>
            <div id="alert" class="alert mt-4 p-3 text-sm rounded-md" style="display: none;"></div>
        </section>

        <!-- Sektion 4: Detaljerad information (De gamla "säljande" delarna) -->
        <section class="section-card mt-12">
            <h2 class="text-3xl font-bold mb-6 text-gray-800 border-b pb-3 border-gray-300">Detaljerad Projektinformation</h2>

            <!-- Projektöversikt (Gammal Sektion 2) -->
            <div class="mb-8 p-4 border-l-4 border-indigo-400 bg-gray-50 rounded-lg">
                <h3 class="text-xl font-semibold mb-3 text-gray-700">WatchRadioSE - Vad appen gör</h3>
                <ul class="list-disc list-inside space-y-2 ml-4 text-gray-700">
                    <li>Helt fristående: Njut av radio utan att ha din telefon i närheten. Anslut till LTE-nätet eller Wi-Fi direkt från din klocka.</li>
                    <li>SR-strömmar: Få tillgång till populära kanaler som P1, P2, P3, P4-kanaler och många fler som erbjuds via Sveriges Radios webbströmmar.</li>
                    <li>Användarvänlig: Ett intuitivt och tydligt gränssnitt, designat specifikt för den runda klockskärmen.</li>
                    <li>Teknisk justering: Justera enkelt bitrate (32, 96, 128, 320 kbps) och buffertstorlek (Låg, Normal, Hög) direkt i appen för att optimera ljudkvalitet och prestanda.</li>
                </ul>
            </div>

            <!-- Testarens Roll (Gammal Sektion 3) -->
            <div class="p-4 border-l-4 border-red-400 bg-gray-50 rounded-lg">
                <h3 class="text-xl font-semibold mb-3 text-gray-700">Fokusområden under Betatestning</h3>
                <p class="mb-4 text-gray-700">Vi behöver specifikt feedback för att säkerställa högsta kvalitet innan lansering. De viktigaste områdena är:</p>
                <ol class="list-decimal list-inside space-y-2 ml-4">
                    <li>Stabilitet och kraschrapporter.</li>
                    <li>LTE/Wi-Fi-anslutning: Hur väl hanterar appen växlingar mellan nätverk och anslutningsavbrott?</li>
                    <li>Gränssnittsflöde: Är navigeringen på den lilla skärmen intuitiv och effektiv?</li>
                </ol>
            </div>
             <p class="mt-8 text-sm text-gray-500">Observera: WatchRadioSE är en oberoende strömningsklient och har ingen officiell koppling till Sveriges Radio.</p>
        </section>

    </main>

    <footer class="text-center py-6 border-t mt-12 bg-gray-50">
        <div class="container mx-auto px-4 text-gray-600 text-sm">
            <p>&copy; 2025 WatchRadioSE. Ett oberoende utvecklingsprojekt.</p>
            <p class="mt-1">Kontakt: <a href="mailto:coxpomona@tuta.io" class="text-indigo-600 hover:text-indigo-800 transition duration-150">coxpomona@tuta.io</a></p>
        </div>
    </footer>

    <script>
        const form = document.getElementById('betaSignupForm');
        const submitBtn = document.getElementById('submitBtn');
        const alertDiv = document.getElementById('alert');
        
        // ⬇️⬇️ DITT GOOGLE APPS SCRIPT URL ⬇️⬇️
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwOcHFzweHmXVXXlhyfSk1jnCJ4Ijvsm4J8QeoCwBuZNTPs2ZSpOUBYtSF656hx3s4q-g/exec';
        
        // Funktion för att hantera retry med exponential backoff (1s, 2s, 4s för nätverksfel)
        async function fetchWithRetry(url, options, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    
                    // Skriptet returnerar nu TEXT (HtmlService) som innehåller en JSON-sträng.
                    const responseText = await response.text();
                    
                    let result;
                    try {
                        // Försöker parsa den inkommande texten som JSON
                        result = JSON.parse(responseText);
                    } catch (e) {
                        // Om svaret inte är giltig JSON, hantera det som ett allvarligt skriptfel
                        throw new Error("Skriptet returnerade ogiltigt svar. Kontrollera skriptloggar.");
                    }

                    // Kontrollerar om HTTP-statusen är OK och om vår egen 'success'-flagga finns
                    if (!response.ok || result.success === undefined) {
                        throw new Error(result.message || 'Ett fel uppstod vid inlämningen. Se skriptloggar.');
                    }
                    return result; // Returnera det parsade resultatet direkt
                } catch (error) {
                    if (i < retries - 1) {
                        // Vänta exponentiellt längre innan nästa försök
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw error;
                    }
                }
            }
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Skickar anmälan...';
            alertDiv.style.display = 'none';
            
            // 1. Förbered data som URL-kodat formulärdata
            const formData = new FormData(form);
            const urlSearchParams = new URLSearchParams(formData);
            const encodedData = urlSearchParams.toString(); // Skickar data i formatet name=X&email=Y
            
            // Validera e-postfältet innan skickning
            if (!formData.get('email')) {
                showAlert('E-postadress är obligatorisk.', 'bg-yellow-100 text-yellow-700 border border-yellow-300');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Skicka in min e-postadress';
                return;
            }

            try {
                // 2. Använd fetchWithRetry med Content-Type för URL-encodat formulär
                const result = await fetchWithRetry(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        // Detta är Content-Type som Apps Script förväntar sig för e.parameter
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: encodedData 
                });
                
                if (result.success) {
                    showAlert('Tack för din anmälan! Du är anmäld som testare, vi återkommer med instruktioner per mail', 'bg-green-100 text-green-700 border border-green-300');
                    form.reset(); // Rensa formuläret
                } else {
                    // Om skriptet svarade med success: false
                    throw new Error(result.message || 'Ett oväntat fel uppstod vid inlämningen.');
                }
                
            } catch (error) {
                // Generiskt felmeddelande
                showAlert('Ett fel uppstod. Fel: ' + error.message, 'bg-red-100 text-red-700 border border-red-300');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Skicka in min e-postadress';
            }
        });
        
        function showAlert(message, classes) {
            alertDiv.textContent = message;
            alertDiv.className = `alert mt-4 p-3 text-sm rounded-md ${classes}`; 
            alertDiv.style.display = 'block';
        }
    </script>
</body>
</html>